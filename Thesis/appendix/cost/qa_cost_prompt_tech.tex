% GPT-4o-mini
\pgfplotstableread[row sep=\\,col sep=&]{
dataset & input & output \\
LoCoMo    & 916359 & 11168 \\
HotpotQA  & 5406415 & 30227 \\
2Wiki     & 10045983 & 49262 \\
MuSiQue   & 1863317 & 9072 \\
}\zsdata

% o3-mini
\pgfplotstableread[row sep=\\,col sep=&]{
dataset & input & output \\
LoCoMo    & 914837 & 786736 \\
HotpotQA  & 5399024 & 4041931 \\
2Wiki     & 10032591 & 6308479 \\
MuSiQue   & 1860903 & 3282503 \\
}\cbdata

% QWen14B
\pgfplotstableread[row sep=\\,col sep=&]{
dataset & input & output \\
LoCoMo    & 979666 & 11204 \\
HotpotQA  & 9358497 & 35014 \\
2Wiki     & 16909346 & 58019 \\
MuSiQue   & 3220550 & 9451 \\
}\hrdata

\begin{figure}[h]
    \centering
    \begin{tikzpicture}[
        every axis/.style={
            ybar stacked,
            bar width=.5cm,
            width=\textwidth,
            height=.5\textwidth,
            grid=major,
            axis line style={draw=none},
            tick label style={font=\scriptsize},
            label style={font=\scriptsize},
            symbolic x coords={LoCoMo,HotpotQA,2Wiki,MuSiQue},
            xtick=data,
            enlarge x limits=0.15,
            nodes near coords,
            nodes near coords align={vertical},
            every node near coord/.append style={
                text=black,
                font=\tiny,
                rotate=90,
                anchor=west,
            },
            ymin=0, ymax=25000000,
            ylabel={Total $token$ consumption},
        }
    ]
    
    \begin{axis}[
        hide axis,
        every node near coord/.append style={
            yshift=0.25cm,
        }
    ]
    % ZS Input (Stacked)
    \addplot+[
        nodes near coords=,
        bar shift=-0.25cm,
        fill={rgb,255:red,130; green,130; blue,180}, draw=none,
    ] table[x=dataset, y=input]{\zsdata};
    
    % ZS Output (Stacked)
    \addplot+[
        bar shift=-0.25cm,
        fill={rgb,255:red,170; green,170; blue,210}, draw=none,
    ] table[x=dataset, y=output]{\zsdata};

    \end{axis}

    \begin{axis}[
        %hide axis,
        every node near coord/.append style={
            yshift=-0.25cm,
        }
    ]
    
    % CB Input (Grouped)
    \addplot+[
        nodes near coords=,
        bar shift=0.25cm,
        fill={rgb,255:red,100; green,190; blue,130}, draw=none,
    ] table[x=dataset, y=input]{\cbdata};
    
    % CB Output (Grouped)
    \addplot+[
        bar shift=0.25cm,
        fill={rgb,255:red,160; green,210; blue,150}, draw=none,
    ] table[x=dataset, y=output]{\cbdata};

    \end{axis}

    \begin{axis}[
        every node near coord/.append style={
            yshift=-0.75cm,
        }
    ]
    
    % HR Input (Grouped)
    \addplot+[
        nodes near coords=,
        bar shift=0.75cm,
        fill={rgb,255:red,230; green,140; blue,70}, draw=none,
    ] table[x=dataset, y=input]{\hrdata};
    
    % HR Output (Grouped)
    \addplot+[
        bar shift=0.75cm,
        fill={rgb,255:red,250; green,170; blue,100}, draw=none,
    ] table[x=dataset, y=output]{\hrdata};

    \end{axis}

    \node[anchor=south, yshift=-1.25em] at (current axis.north) {
        \begin{tikzpicture}[baseline]
            \node[
                fill=white,
                draw=gray!50,
                rounded corners=2pt,
                inner sep=4pt
            ] {
                \shortstack{
                    \begin{tabular}{@{}c@{\hskip 0.5em}c@{\hskip 1.5em}c@{\hskip 0.5em}c@{\hskip 1.5em}c@{\hskip 0.5em}c@{}}
                        \tikz \draw[fill={rgb,255:red,130; green,130; blue,180}, draw=none] (0,0) rectangle (0.4cm,0.2cm); & \scriptsize GPT-4o-mini &
                        \tikz \draw[fill={rgb,255:red,100; green,190; blue,130}, draw=none] (0,0) rectangle (0.4cm,0.2cm); & \scriptsize o3-mini &
                        \tikz \draw[fill={rgb,255:red,230; green,140; blue,70}, draw=none] (0,0) rectangle (0.4cm,0.2cm); & \scriptsize QWen2.5-14B \\
                    \end{tabular}
                    \\
                    {\tiny \textit{Darker shades correspond to input tokens, while lighter shades to output tokens}}
                }
            };
        \end{tikzpicture}
    };
    
    \end{tikzpicture}
    \caption{Total $Token$ usage between GPT-4o-mini, o3-mini, and QWen2.5-14B using ColBERTV2 retriever with $k=5$ on QA datasets.}
    \label{fig:qa_token_prompt_tech}
\end{figure}
